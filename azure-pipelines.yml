trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
- task: Checkout@2
  inputs:
    fetchDepth: 0  # Ensure a full clone for better analysis

- task: Docker@2
  inputs:
    command: 'pull'
    container: 'blacklocksec/code-scanner:latest'
  displayName: 'Pull Blacklock Code Scanner Docker Image'

- script: |
    docker run --rm -v $(Build.SourcesDirectory):/app -e SONAR_PROJECTKEY="azure-one" -e SONAR_HOST_URL=$(SONAR_HOST_URL) -e SONAR_TOKEN=$(SONAR_TOKEN) blacklocksec/code-scanner:latest
  displayName: 'Run Blacklock Code Scanner'
  env:
    SONAR_HOST_URL: $(SONAR_HOST_URL)
    SONAR_TOKEN: $(SONAR_TOKEN)
